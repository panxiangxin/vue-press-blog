# JS 闭包理解 

## 一、闭包的定义

### 红宝书的定义

```
闭包就是一个函数可以访问另一个函数内部作用域变量的函数。
```

### MDN 上的定义

```
闭包是指那些能够访问自由变量的函数，这里的自由变量指的是外部作用域的变量。
```

### 涉及到的知识点

#### 1. 作用域

作用域： 负责收集并且维护由所有声明的标识符（变量）组成的一些列查询，并实施一套非常严格的规则，确定当前执行代码对这些标识符的访问权限。

JS里面，函数、块、模块 都可以形成作用域（一个存放变量的独立空间）。他们之间可以相互嵌套，作用域之间会形成引用关系，这条链叫做作用域链。

作用域分为全局作用域 GO 和局部作用域（函数作用域）AO。GO 全局作用域 是在全局执行上下文初始化时就已经确定的。函数作用域 是函数执行时，会建立一个自己的AO。


```javascript

var color = "blue";

function changeColor() {
    let anotherColor = "red";

    function swapColors() {
        let tempColor = anotherColor;
        anotherColor = color;
        color = tempColor;
    }

    swapColors();
}

changeColor();

```
全局执行上下文

```javascript
GlobalContext: {
    ...window,
    color = "blue",
    changeColor: fn
}
```
*changeColor* 调用

```javascript
changeColorContext: {
    'activation object' : {
        tempColor,
    }, 

    'scope chain': [changeColorContext => changeColorContext => GlobalContext]
}
```
swapColor 调用

```javascript
swapColorContext: {
    'activation object' : {
        anotherColor = 'red',
        swapColors: fn
    }, 

    'scope chain': [changeColorContext => GlobalContext]
}
```

也就是 *代码执行时的标识符解析是通过沿作用域链逐级搜索标识符名称完成的。搜索过程始终从作用域链的最前端开始，然后逐级往上，直到找到标识符，不然就抛出标识符未定义错误。*

## 二、闭包的优缺点

优点：

私有化数据，在私有化数据的基础上保持数据 *（任何在函数中定义的变量，都可以认为是私有变量）*

缺点：

可能会导致内存泄漏，内部的变量不会被自动回收掉。

## 三、闭包的用途

用途广泛。

- 1.模块化
- 2.声明局部变量 私有化数据
- 3.具体一点的高阶函数都有用到 防抖、节流等等